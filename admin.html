<!-- Updated admin panel with time-based bulk update -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel - JNK Express</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', sans-serif; background: #fff3f3; padding: 20px; max-width: 800px; margin: auto; }
    h2 { color: #D7282F; }
    input, select, button {
      width: 100%; padding: 12px; margin-top: 10px;
      font-size: 1em; border-radius: 6px; border: 1px solid #ccc;
    }
    button { background-color: #D7282F; color: white; border: none; margin-bottom: 20px; cursor: pointer; }
    .top-bar { display: flex; gap: 10px; flex-wrap: wrap; }
  </style>
</head>
<body>
  <!-- Form elements -->
  <div class="top-bar">
    <input type="date" id="bulkDate" placeholder="Select Date to Apply" />
    <input type="time" id="startTime" />
    <input type="time" id="endTime" />
    <select id="bulkStatus">
      <option value="">Update Status to...</option>
      <option>Package Received</option>
      <option>In Transit</option>
      <option>Arrived</option>
      <option>For Pick-up</option>
    </select>
    <input type="text" id="bulkLocation" placeholder="Optional New Location" />
    <button onclick="bulkUpdateByTimeRange()">Apply to Date + Time Range</button>
  </div>

  <script>
    async function bulkUpdateByTimeRange() {
      const date = document.getElementById("bulkDate").value;
      const start = document.getElementById("startTime").value;
      const end = document.getElementById("endTime").value;
      const status = document.getElementById("bulkStatus").value;
      const location = document.getElementById("bulkLocation").value.trim();

      if (!date || !start || !end || !status) return alert("Fill all date/time/status fields.");

      const confirmPass = prompt("Enter admin password to apply bulk update:");
      if (confirmPass !== PASSWORD) return alert("❌ Incorrect password.");

      const fromDate = new Date(`${date}T${start}`);
      const toDate = new Date(`${date}T${end}`);

      const snapshot = await db.collection("tracking").get();
      const batch = db.batch();

      snapshot.docs.forEach(doc => {
        const data = doc.data();
        const entryDate = data.timestamp?.toDate();
        if (entryDate >= fromDate && entryDate <= toDate) {
          const history = data.statusHistory || [];
          history.push({ status, timestamp: firebase.firestore.Timestamp.now() });
          batch.set(doc.ref, {
            location: location || data.location,
            estimatedDate: data.estimatedDate || '',
            statusHistory: history,
            timestamp: firebase.firestore.Timestamp.now()
          });
        }
      });

      await batch.commit();
      alert("✅ Bulk update applied to selected date and time range.");
      loadAllEntries();
    }
  </script>
</body>
</html>
